import Connect from '@/components/extension/hook/connect';
import Account from '@/components/extension/hook/account';
import SignAmino from '@/components/extension/hook/sign-amino';
import SignDirect from '@/components/extension/hook/sign-direct';
import SignAndSend from '@/components/extension/hook/sign-and-send';

# React hook

## Installation

The Cosmostation wallet hook package lives in npm. To install the latest stable version, run the following command:

```bash
npm install @cosmostation/use-wallets
```

Or if you're using yarn:

```bash
yarn add @cosmostation/use-wallets
```

## CosmosProvider

Components that use cosmos wallet state need `CosmosProvider` to appear somewhere in the parent tree. A good place to put this is in your root component:

```jsx filename="example"
import { CosmosProvider } from '@cosmostation/use-wallets';

function App() {
  return (
    <CosmosProvider>
      <MyApp />
    </CosmosProvider>
  );
}
```

## useCosmosWallets

With `useCosmosWallets`, you can select a list of wallets, the wallet you are currently using, and the wallet you want to use.
The wallet list is automatically inserted in extensions.

```jsx filename="example"
import { useCosmosWallets } from '@cosmostation/use-wallets';

function Connect() {
  const { cosmosWallets, selectWallet } = useCosmosWallets();

  return (
    <div>
      {cosmosWallets.map((wallet) => (
        <button
          onClick={() => {
            selectWallet(wallet.id);
          }}
        >
          <img src={wallet.logo} alt={wallet.name} width={40} height={40} /> {wallet.name}
        </button>
      ))}
    </div>
  );
}
```

<Connect />

## useCosmosAccount

With `useCosmosAccount`, you can get the account information of the wallet you are currently using.

### Account

Account automatically requests account information the moment a wallet is selected. If you want to request more manually, you can use 'mutate'.

- [Type](#account-1)

```jsx filename="example"
import { useCosmosAccount } from '@cosmostation/use-wallets';

export default function Account() {
  const { data, error, mutate } = useCosmosAccount('cosmoshub-4');

  useEffect(() => {
    console.log('address', data?.account);
    console.log('error', error);
  }, [data, error]);

  return <button onClick={() => mutate()}>Request Account</button>;
}
```

<Account />

### Methods

the available methods in the selected account. (e.g. sign)

- [Type](#cosmosmethods)

#### requestAccount

```jsx filename="example"
import { useCosmosAccount } from '@cosmostation/use-wallets';

export default function Account() {
  const { data } = useCosmosAccount('cosmoshub-4');

  return <button onClick={() => mutate()}>Request Account</button>;
}
```

---

#### signAmino

- [Amino Doc Type](#cosmossignaminodoc)

```jsx filename="example" highlight=1,4,14
import { useCosmosAccount } from '@cosmostation/use-wallets';

export default function SignAmino() {
  const { data } = useCosmosAccount('cosmoshub-4');

  const sendExampleDoc = {
    // ...
  };

  return (
    <button
      onClick={async () => {
        try {
          console.dir(await data?.methods.signAmino(sendExampleDoc), { depth: 100 });
        } catch (e) {
          console.log(e.message);
        }
      }}
    >
      Sign Amino
    </button>
  );
}
```

<SignAmino />

---

#### signDirect

- [Direct Doc Type](#cosmossigndirectdoc)

```jsx filename="example"
import { useCosmosAccount } from '@cosmostation/use-wallets';

export default function SignDirect() {
  const { data } = useCosmosAccount('cosmoshub-4');

  const sendExampleDoc = {
    // ...
  };

  return (
    <button
      onClick={async () => {
        try {
          const result = await data?.methods.signDirect(sendExampleDoc);
          console.dir(result, { depth: 100 });
        } catch (e) {
          console.log(e.message);
        }
      }}
    >
      Sign Direct
    </button>
  );
}
```

<SignDirect />

---

#### signAndSendTransaction

A method that combines sign and send using `signDirect`  
Receives message as json and automates creation of protobuf

[JSON e.g.](proto)

```jsx filename="example"
import { useCosmosAccount } from '@cosmostation/use-wallets';

export default function SignAndSendTransaction() {
  const { data } = useCosmosAccount('cosmoshub-4');

  return (
    <Button
      onClick={async () => {
        try {
          console.dir(
            await data?.methods.signAndSendTransaction({
              messages: [
                {
                  type_url: '/cosmos.bank.v1beta1.MsgSend',
                  value: {
                    from_address: data?.account.address,
                    to_address: data?.account.address,
                    amount: [
                      {
                        denom: 'uatom',
                        amount: '1',
                      },
                    ],
                  },
                },
              ],
              memo: 'Test (Sign And Send Transaction)',
            }),
            { depth: 100 },
          );
        } catch (e) {
          console.log(e.message);
        }
      }}
    >
      Sign Direct
    </Button>
  );
}
```

<SignAndSend />

## Type

### Account

```typescript
interface Account {
  data?: {
    account: CosmosAccount;
    methods: CosmosMethods;
  };
  error?: string;
  mutate: () => void;
}
```

### CosmosAccount

```typescript
interface CosmosAccount {
  address: string;
  public_key: {
    type: CosmosPublicKeyType;
    value: string;
  };
  name?: string;
  is_ledger?: boolean;
}
```

### CosmosPublicKeyType

```typescript
type CosmosPublicKeyType = 'secp256k1' | 'ethsecp256k1';
```

### CosmosMethods

```typescript
interface CosmosMethods {
  requestAccount: (chainId: string) => Promise<CosmosAccount>;
  signAndSendTransaction: (
    props: SignAndSendTransactionProps,
    options?: SignOptions,
  ) => Promise<CosmosSendTransactionResponse>;
  signAmino: (
    document: CosmosSignAminoDoc,
    options?: SignOptions,
  ) => Promise<CosmosSignAminoResponse>;
  signDirect: (
    document: CosmosSignDirectDoc,
    options?: SignOptions,
  ) => Promise<CosmosSignDirectResponse>;
  sendTransaction: (
    tx_bytes: Uint8Array | string,
    mode?: number,
  ) => Promise<CosmosSendTransactionResponse>;
  getSupportedChainIds: () => Promise<string[]>;
  signMessage?: (message: string, signer: string) => Promise<CosmosSignMessageResponse>;
  verifyMessage?: (message: string, signature: string) => Promise<boolean>;
}
```

### CosmosSignAminoDoc

```typescript
interface CosmosSignAminoDoc {
  sequence: string;
  account_number: string;
  fee: {
    amount?: {
      denom: string;
      amount: string;
    }[];
    gas: string;
  };
  memo: string;
  msgs: {
    type: string;
    value: any;
  }[];
}
```

### CosmosSignAminoResponse

```typescript
interface CosmosSignAminoResponse {
  signature: string;
  signed_doc: any;
}
```

### CosmosSignDirectDoc

```typescript
interface CosmosSignDirectDoc {
  account_number: string;
  body_bytes: string | Uint8Array;
  auth_info_bytes: string | Uint8Array;
}
```

### CosmosSignDirectResponse

```typescript
interface CosmosSignDirectResponse {
  signature: string;
  signed_doc: CosmosSignedDoc;
}
```

### CosmosSendTransactionResponse

```typescript
interface CosmosSendTransactionResponse {
  tx_response: {
    code: number;
    txhash: string;
    raw_log?: unknown;
    codespace?: unknown;
    tx?: unknown;
    log?: unknown;
    info?: unknown;
    height?: unknown;
    gas_wanted?: unknown;
    gas_used?: unknown;
    events?: unknown;
    data?: unknown;
    timestamp?: unknown;
  };
}
```

### SignAndSendTransactionProps

```typescript
export interface SignAndSendTransactionProps {
  messages: Message[];
  memo?: string;
  fee?: Fee;
  sequence?: number;
  lcd_url?: string;
  fee_denom?: string;
  gas_rate?: number;
  payer?: string;
  granter?: string;
}

interface Message {
  type_url: string;
  value?: unknown;
}
```

### Fee

```typescript
interface Fee {
  amount: Amount[];
  gas_limit: number;
  payer?: string;
  granter?: string;
}

interface Amount {
  denom: string;
  amount: number;
}
```
